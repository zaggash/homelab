services:
  booklore:
    container_name: booklore
    depends_on:
     books-db:
        condition: service_healthy
    image: ghcr.io/booklore-app/booklore:v1.18.4@sha256:636cdafcb29277083c6590a4dd3b451a7e7efa76526b19d363cecfeedbb156df
    labels:
      folder.view2: Media
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/booklore.png
      traefik.enable: true
      traefik.docker.network: homelab_media
      traefik.http.middlewares.kobo-sync-headers.headers.customrequestheaders.X-Scheme: https
      traefik.http.routers.booklore.rule: Host(`books.${SECRET_DOMAIN}`)
      traefik.http.routers.booklore.entryPoints: websecure
      traefik.http.routers.booklore.middlewares: kobo-sync-headers
      traefik.http.services.booklore.loadbalancer.server.port: 6060
    volumes:
      - "${SECRET_APPDATA}/booklore/data:/app/data"
      - "${SECRET_DATADIR}/downloads/complete/ebooks_import:/bookdrop"
      - "${SECRET_DATADIR}/media/ebooks:/books"
    environment:
      TZ: ${TZ}
      USER_ID: ${UID}
      GROUP_ID: ${GID}
      DATABASE_URL: jdbc:mariadb://books-db:3306/booklore
      DATABASE_USERNAME: ${BOOKLORE_MARIADB_USERNAME}
      DATABASE_PASSWORD: ${BOOKLORE_MARIADB_PASSWORD}
      BOOKLORE_PORT: 6060
      SWAGGER_ENABLED: false
    networks:
      - media
      - media-backend
    restart: always
