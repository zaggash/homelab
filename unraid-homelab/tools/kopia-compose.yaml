services:
  kopia:
    container_name: kopia
    hostname: kopia
    image: kopia/kopia:20210610.0.183500@sha256:6fa4e6ebb1b1a19e23f64a563e15dc61ec4aeeb5bb4d55e8d09d4e48dee1b01e
    command:
      - server
      - start
      - --disable-csrf-token-checks
      - --insecure
      - --address=0.0.0.0:51515
      - --server-username=${SECRET_KOPIA_UI_USERNAME}
      - --server-password=${SECRET_KOPIA_UI_PASSWORD}
    ports:
      - 192.168.1.12:51515:51515
    volumes:
      - "${SECRET_APPDATA}/kopia/config:/app/config"
      - "${SECRET_APPDATA}/kopia/cache:/app/cache"
      # Mount repository location
      - "${SECRET_ROOTDIR}/backups/kopia:/repository"
      # Mount path for browsing mounted snaphots
      - "${SECRET_APPDATA}/kopia/tmp:/tmp:shared"
      # Mount local folders to snapshot
      - "${SECRET_ROOTDIR}:/backuproot:ro"
    environment:
      TZ: ${TZ}
      KOPIA_PASSWORD: ${SECRET_KOPIA_REPO_PASSWORD}
    networks:
      - default
    restart: always
