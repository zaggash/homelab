services:
  minecraft_proxy:
    container_name: minecraft-proxy
    image: ghcr.io/zaggash/bedrock-connect:v1.50@sha256:759be16f43beb603994c15bbdff88e299a04c8ced19134732783729efc7205e4
    labels:
      folder.view: Minecraft
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/bedrock-connect.png
    init: true
    ports:
      - 19132:19132/tcp
      - 19132:19132/udp
    restart: always

  server:
    container_name: minecraft-server
    image: itzg/minecraft-server:java21@sha256:ef2651f53b70a6555943cc92ae58fd91ceae4c1527cdb866824f2466f7e9920b
    labels:
      folder.view: Minecraft
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/minecraft.png
      traefik.enable: true
      traefik.http.routers.vaultwarden.rule: Host(`mc.${SECRET_DOMAIN}`)
      traefik.http.routers.vaultwarden.entryPoints: websecure
      traefik.http.services.vaultwarden.loadbalancer.server.port: 8123
    init: true
    environment:
      ## Global settings ##
      UID: "${UID}"
      GID: "${GID}"
      TZ: 'Europe/Paris'
      LOG_TIMESTAMP: true
      DEBUG_MEMORY: true
      DEBUG_EXEC: true
      MEMORY: 5G
      ENABLE_ROLLING_LOGS: true
      USE_AIKAR_FLAGS: true
      ## Minecraft settings ##
      EULA: "TRUE"
      TYPE: PAPER # Download latest Paper Fork
      VERSION: 1.21.1 # Set minecraft server version
      # PLUGINS / MODS
      # SleepMost(60623) [Ask players to skip night in a bed]
      SPIGET_RESOURCES: |
        60623
      # Geyser [Bridge between Bedrock and Java Edition]
      # FloodGate [Allow Bedrock to not have Paid Java account]
      PLUGINS: |
        https://download.geysermc.org/v2/projects/geyser/versions/latest/builds/latest/downloads/spigot
        https://download.geysermc.org/v2/projects/floodgate/versions/latest/builds/latest/downloads/spigot
      MODRINTH_PROJECTS: |
        viaversion:release
      ## server.properties ##
      OVERRIDE_ICON: TRUE
      ICON: "https://cdn-icons-png.flaticon.com/512/1409/1409036.png"
      SNOOPER_ENABLED: false
      LEVEL: DefaultWorld
      #SEED: ""
      SERVER_NAME: "Serveur Maison"
      MOTD: "Bienvenue"
      MAX_PLAYERS: 6
      ANNOUNCE_PLAYER_ACHIEVEMENTS: true
      ENFORCE_WHITELIST: TRUE
      WHITELIST: "${SECRET_USERNAME}"
      OPS: "${SECRET_USERNAME}"
      DIFFICULTY: easy
      ONLINE_MODE: false
      ENABLE_RCON: false
      LEVEL_TYPE: "minecraft:normal"
      MODE: survival
      PVP: true
      HARDCORE: false
      FORCE_GAMEMODE: true
      ALLOW_FLIGHT: false
      MAX_BUILD_HEIGHT: 300
      GENERATE_STRUCTURES: true
      VIEW_DISTANCE: 10
      SPAWN_PROTECTION: 16
      ALLOW_NETHER: true
      SPAWN_ANIMALS: true
      SPAWN_MONSTERS: true
      SPAWN_NPCS: true
      PLAYER_IDLE_TIMEOUT: 5
    volumes:
      - "${SECRET_APPDATA}/minecraft:/data"
    ports:
      - 25565:25565/tcp
      - 25565:25565/udp
      - 19133:19133/tcp
      - 19133:19133/udp
    tty: true
    stdin_open: true
    restart: always
