services:
    immich-microservices:
      container_name: immich_microservices
      image: ghcr.io/immich-app/immich-server:v1.105.0@sha256:5aa1745048ecd84769e4c431231c73f6f5204e207427603c89c1a4ec8febe850
      command: ['start.sh', 'microservices']
      labels:
        folder.view: Immich
        net.unraid.docker.icon: ${SECRET_APPDATA}/icons/immich.png
      devices:
        - /dev/dri:/dev/dri
      networks:
        - immich-db
        - immich
      volumes:
        - ${SECRET_IMMICH_UPLOAD_LOCATION}:/usr/src/app/upload
        - /etc/localtime:/etc/localtime:ro
      environment:
        TZ: ${TZ}
        LOG_LEVEL: log
        IMMICH_METRICS: false
        DB_HOSTNAME: immich_pg
        DB_DATABASE_NAME: ${SECRET_IMMICH_DB_DATABASE_NAME}
        DB_USERNAME: ${SECRET_IMMICH_DB_USERNAME}
        DB_PASSWORD: ${SECRET_IMMICH_DB_PASSWORD}
        REDIS_HOSTNAME: immich_redis
        #REDIS_PASSWORD: ${SECRET_IMMICH_REDIS_PASSWORD}
      restart: always
