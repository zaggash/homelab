services:
  immich-server:
    container_name: immich_server
    image: ghcr.io/immich-app/immich-server:v1.101.0@sha256:0097562444db38ebd2e5f98e71bd27dc6dd69b7f786207f7d323febbf99b8f93
    command: ['start.sh', 'immich']
    labels:
      traefik.enable: true
      traefik.http.routers.immich.rule: Host(`photos.${SECRET_DOMAIN}`)
      traefik.http.routers.immich.entryPoints: websecure
      traefik.http.services.immich.loadbalancer.server.port: 3001
    networks:
      - proxy
      - immich
      - immich-db
    volumes:
      - ${SECRET_IMMICH_UPLOAD_LOCATION}:/usr/src/app/upload
      - /etc/localtime:/etc/localtime:ro
    environment:
      LOG_LEVEL: log
      IMMICH_METRICS: false
      DB_HOSTNAME: immich_pg
      DB_DATABASE_NAME: ${SECRET_IMMICH_DB_DATABASE_NAME}
      DB_USERNAME: ${SECRET_IMMICH_DB_USERNAME}
      DB_PASSWORD: ${SECRET_IMMICH_DB_PASSWORD}
      REDIS_HOSTNAME: immich_redis
      #REDIS_PASSWORD: ${SECRET_IMMICH_REDIS_PASSWORD}
    restart: always

