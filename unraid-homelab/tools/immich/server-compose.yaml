services:
  immich-server:
    container_name: immich_server
    image: ghcr.io/immich-app/immich-server:v1.105.0@sha256:5aa1745048ecd84769e4c431231c73f6f5204e207427603c89c1a4ec8febe850
    command: ['start.sh', 'immich']
    labels:
      folder.view: Immich
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/immich.png
      traefik.enable: true
      traefik.http.routers.immich.rule: Host(`photos.${SECRET_DOMAIN}`)
      traefik.http.routers.immich.entryPoints: websecure
      traefik.http.services.immich.loadbalancer.server.port: 3001
    networks:
      - proxy
      - immich
      - immich-db
    volumes:
      - ${SECRET_IMMICH_UPLOAD_LOCATION}:/usr/src/app/upload
      - /etc/localtime:/etc/localtime:ro
    environment:
      LOG_LEVEL: log
      IMMICH_METRICS: false
      DB_HOSTNAME: immich_pg
      DB_DATABASE_NAME: ${SECRET_IMMICH_DB_DATABASE_NAME}
      DB_USERNAME: ${SECRET_IMMICH_DB_USERNAME}
      DB_PASSWORD: ${SECRET_IMMICH_DB_PASSWORD}
      REDIS_HOSTNAME: immich_redis
      #REDIS_PASSWORD: ${SECRET_IMMICH_REDIS_PASSWORD}
    restart: always
