services:
  n8n:
    container_name: n8n
    image: ghcr.io/n8n-io/n8n:1.114.0@sha256:53fa4605b931ccb0076b6b9163844ce36bb7f33f12ca5a6b4f14ddfba2dc077c
    labels:
      folder.view2: Tools
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/n8n.png
      traefik.enable: true
      traefik.docker.network: homelab_tools
      traefik.http.routers.n8n.rule: Host(`n8n.${SECRET_DOMAIN}`)
      traefik.http.routers.n8n.entryPoints: websecure
      traefik.http.services.n8n.loadbalancer.server.port: 5678
    volumes:
      - "${SECRET_APPDATA}/n8n/data:/home/node/.n8n"
    environment:
      TZ: ${TZ}
      GENERIC_TIMEZONE: ${TZ}
      N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: true
      N8N_HOST: n8n.${SECRET_DOMAIN}
      N8N_PORT: 5678
      N8N_RUNNERS_ENABLED: true
      NODE_ENV: production
      WEBHOOK_URL: https://n8n.${SECRET_DOMAIN}/
      DB_SQLITE_POOL_SIZE: 20
      N8N_SMTP_HOST: ${SECRET_OVH_SMTP_HOST}
      N8N_SMTP_PORT: 465
      N8N_SMTP_USER: ${SECRET_OVH_SMTP_USERNAME}
      N8N_SMTP_PASS: ${SECRET_OVH_SMTP_PASSWORD}
      N8N_SMTP_SENDER: n8n@${SECRET_DOMAIN}
    networks:
      - tools
    restart: always

networks:
  tools:
