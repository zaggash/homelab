services:
  db-backup:
    container_name: db-backup
    image: ghcr.io/tiredofit/docker-db-backup:4.1.21@sha256:36e7888e4887e57e3ab3ec5ecd4782f345226084df6d3fdd93b2d3e4a2162274
    labels:
      folder.view2: Tools
      net.unraid.docker.icon: ${SECRET_APPDATA}/icons/db-backup.png
    volumes:
      # Default Volumes
      - ${SECRET_APPDATA}/db-backup/scripts:/assets/scripts
      - ${SECRET_BACKUPSHARE}/databases:/backup
    environment:
      TIMEZONE: ${TZ}
      CONTAINER_ENABLE_MONITORING: false
      #DEBUG_MODE=TRUE
      USER_DBBACKUP: ${UID}
      GROUP_DBBACKUP: ${GID}
      BACKUP_JOB_CONCURRENCY: 3
      DEFAULT_BACKUP_BEGIN: "00 00 * * *" # Default backup everyday at midnight
      DEFAULT_CLEANUP_TIME: 8640 # Cleanup backups after a week
      DEFAULT_BACKUP_LOCATION: FILESYSTEM
      DEFAULT_FILESYSTEM_PATH: /backup
      DEFAULT_COMPRESSION: GZ
      DEFAULT_GZ_RSYNCABLE: true
      ### Booklore DB
      DB01_TYPE: mysql
      DB01_HOST: books-db
      DB01_NAME: ALL
      DB01_BACKUP_LOCATION: /backup/booklore
      DB01_USER: ${BOOKLORE_MARIADB_USERNAME}
      DB01_PASS: ${BOOKLORE_MARIADB_PASSWORD}
      DB01_BACKUP_BEGIN: "45 01 * * *" # https://crontab.guru/#45_01_*_*_*
      DB01_CLEANUP_TIME: 43200 # 1 Mois
    networks:
      - media-backend
    restart: always
