version: "3"
services:
  proxy:
    image: ghcr.io/zaggash/bedrock-connect:v1.40@sha256:c0ae8287312d514cd0978bfb936538c01920d4d450e7be349ca5608d081fad22
    init: true
    dns:
      - 192.168.1.10
      - 1.0.0.1
    ports:
      - 19132:19132/tcp
      - 19132:19132/udp
    restart: always

  server:
    image: itzg/minecraft-server:java20@sha256:cd540e587462ff8a2af3eb29dc806d05ff9877d92e6d4ef630ee97d1b09d2248
    init: true
    dns:
      - 192.168.1.10
      - 1.0.0.1
    environment:
      ## Global settings ##
      TZ: 'Europe/Paris'
      EULA: "TRUE"
      LOG_TIMESTAMP: true
      DEBUG_MEMORY: true
      DEBUG_EXEC: true
      MEMORY: 5G
      ENABLE_ROLLING_LOGS: true
      USE_AIKAR_FLAGS: true
      ## Minecraft settings ##
      TYPE: PAPER # Download latest Paper Fork
      VERSION: 1.19.2 # Set minecraft server version
      SPIGET_RESOURCES: "19254,60623" # Download plugins : ViaVersion + SleepMost
      # Add latest Geyser /  FloodGate / Dynmap (274)
      MODS: "https://ci.opencollab.dev/job/GeyserMC/job/Geyser/job/master/lastSuccessfulBuild/artifact/bootstrap/spigot/build/libs/Geyser-Spigot.jar,
             https://ci.opencollab.dev/job/GeyserMC/job/Floodgate/job/master/lastSuccessfulBuild/artifact/spigot/build/libs/floodgate-spigot.jar,
             https://mediafilez.forgecdn.net/files/4444/998/Dynmap-3.5-beta-3-spigot.jar"
      # server.properties #
      OVERRIDE_ICON: TRUE
      ICON: "https://cdn-icons-png.flaticon.com/512/1409/1409036.png"
      NOOPER_ENABLED: false
      LEVEL: MyHomeWorld
      SEED: "-266100150045570408"
      SERVER_NAME: "Serveur Maison"
      MOTD: "Bienvenue."
      MAX_PLAYERS: 6
      ANNOUNCE_PLAYER_ACHIEVEMENTS: true
      ENFORCE_WHITELIST: TRUE
      WHITELIST: "Zaggash"
      OPS: "Zaggash"
      DIFFICULTY: easy
      ONLINE_MODE: true
      ENABLE_RCON: false
      LEVEL_TYPE: "minecraft:normal"
      MODE: survival
      PVP: true
      HARDCORE: false
      FORCE_GAMEMODE: true
      ALLOW_FLIGHT: false
      MAX_BUILD_HEIGHT: 300
      GENERATE_STRUCTURES: true
      VIEW_DISTANCE: 10
      SPAWN_PROTECTION: 16
      ALLOW_NETHER: true
      SPAWN_ANIMALS: true
      SPAWN_MONSTERS: true
      SPAWN_NPCS: true
      PLAYER_IDLE_TIMEOUT: 5
    volumes:
      - data:/data
    ports:
      - 25565:25565/tcp
      - 25565:25565/udp
      - 19133:19133/tcp
      - 19133:19133/udp
      - 8123:8123/tcp
    tty: true
    stdin_open: true
    restart: always

volumes:
  data:
