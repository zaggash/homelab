version: "3"

services:
  minecraft: &backup_service
    image: offen/docker-volume-backup:v2.42.0@sha256:095c1b9139ea1676cfd3da3d231804bb5131f6adda519ecc838987c025ea40df
    restart: always
    dns:
      - 192.168.1.10
    environment: &backup_env
      BACKUP_FILENAME: "minecraft-%Y-%m-%dT%H-%M-%S.tar.gz"
      BACKUP_LATEST_SYMLINK: "minecraft-latest.tar.gz"
      BACKUP_ARCHIVE: "/archive/minecraft"
      BACKUP_CRON_EXPRESSION: "0 3 * * *"
      BACKUP_RETENTION_DAYS: "7"
      BACKUP_PRUNING_PREFIX: "minecraft-"
      NOTIFICATION_URLS: $NOTIFICATION_URLS
      NOTIFICATION_LEVEL: "error"
    volumes:
      - "minecraft_data:/backup/minecraft/data:ro"
      - "unraid_backups:/archive"

volumes:
  minecraft_data:
    external: true
  unraid_minecraft:
    driver: local
    driver_opts:
      type: nfs
      o: addr=192.168.1.12,nfsvers=4
      device: :/mnt/user/remote-backups
