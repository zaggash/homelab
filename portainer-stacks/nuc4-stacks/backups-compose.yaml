version: "3"

services:
  minecraft: &backup_service
    image: offen/docker-volume-backup:v2.33.0@sha256:29baeba73b7425ad5f8625973e840efe54ae9160362558c34018168696694832
    restart: always
    dns:
      - 192.168.1.10
    environment: &backup_env
      AWS_ENDPOINT: "s3.home.lan:9000"
      AWS_ENDPOINT_PROTO: "https"
      AWS_ENDPOINT_INSECURE: "false"
      AWS_ENDPOINT_CA_CERT: "-----BEGIN CERTIFICATE-----\nMIID9jCCAt6gAwIBAgIEAKInCjANBgkqhkiG9w0BAQsFADCBhjEPMA0GA1UEAwwG\nUk9PVENBMQswCQYDVQQGEwJGUjEOMAwGA1UECAwFTWFybmUxEzARBgNVBAcMCk1v\nbnRtaXJhaWwxDTALBgNVBAoMBEhvbWUxDDAKBgNVBAsMA0xhYjEkMCIGCSqGSIb3\nDQEJARYVd2VibWFzdGVyQHppZ2d6YWdnLmZyMB4XDTIyMDkxNjAwMjQyM1oXDTMy\nMDkxMzAwMjQyM1owgYYxDzANBgNVBAMMBlJPT1RDQTELMAkGA1UEBhMCRlIxDjAM\nBgNVBAgMBU1hcm5lMRMwEQYDVQQHDApNb250bWlyYWlsMQ0wCwYDVQQKDARIb21l\nMQwwCgYDVQQLDANMYWIxJDAiBgkqhkiG9w0BCQEWFXdlYm1hc3RlckB6aWdnemFn\nZy5mcjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANozLqwal9QeuAMl\npTYAmnv5lNULsX26e26D6eoKfUY8CUjO0zuy3QfL78xpSUfF8gnWTVkAtYHrvB2C\nTcF0yC4KpFytC+rKqOrtv7/wAJSam712gNXbpzwi35TujKKDSie4LDFni15fFNER\nro7kMGpmsUA096wipFPv7ly71BAqeutqHX4uVNQ7BlzxpjDldhu6J+0hmLM1ltwB\nOZTKP8XftXqQ7oU5O5fCulATDuu+5T9ODlIxDYoLiyjjtPIjT534tPLuZdCkKhXE\noiUvbFXqm4trMx72dEZDtUIAyZzh6pzh1DnUCE5P9+jzid9eBhU4VOf+At1ynTib\n7JKJBKcCAwEAAaNqMGgwEQYDVR0RBAowCIIGUk9PVENBMB0GA1UdDgQWBBQnpVZs\nPRZLK36zqTJ2S84w0i7GXDAPBgNVHRMBAf8EBTADAQH/MBMGA1UdJQQMMAoGCCsG\nAQUFBwMBMA4GA1UdDwEB/wQEAwIBBjANBgkqhkiG9w0BAQsFAAOCAQEAdsN5pcNJ\nbjwqzxNxkcCC4wO5BA/70YJUgdg8i5SV4nBXvkkaJDp2sH0qVI8yObibeaTjpZE8\nhN+Sg5awBUl6IsABE8RozgkVozEOH3tMcWoGN7XiqrV9DcXDdzzGJQw8kLRc3ji8\nEqvQErM8ps0iycO1sL6DEzhLkjk4oHkjQNiPaZmw0+WJMAZcFx5Wi4mJ+xEaCzE4\nP+0CqjFXyecMnvsq1Q2rTN827nGIz3ovY3CYxH8RA2dwVadsJdyT1FcCFlETMAI3\n/Hq/YHueFS272u8JlhE0b/zsX26SwVVjJAw245XAv2GXdR7nPZu/CYe7xjNdt3HK\nRg26Hvk5j3aC5Q==\n-----END CERTIFICATE-----\n"
      AWS_ACCESS_KEY_ID: "docker-volumes-backup"
      AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
      AWS_S3_BUCKET_NAME: "docker-volumes-backup"
      AWS_S3_PATH: "/minecraft"
      BACKUP_FILENAME: "minecraft-%Y-%m-%dT%H-%M-%S.tar.gz"
      BACKUP_CRON_EXPRESSION: "0 6 * * *"
      BACKUP_RETENTION_DAYS: "14"
      BACKUP_PRUNING_PREFIX: "minecraft-"
      NOTIFICATION_URLS: $NOTIFICATION_URLS
      NOTIFICATION_LEVEL: "error"
    volumes:
      - "minecraft_data:/backup/minecraft/data:ro"

volumes:
  minecraft_data:
    external: true
