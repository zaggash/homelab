apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: filebrowser
spec:
  interval: 15m
  chart:
    spec:
      chart: app-template
      version: "1.5.1"
      sourceRef:
        kind: HelmRepository
        name: bjw-s-charts
        namespace: flux-system
  maxHistory: 3
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    podAnnotations:
      backup.velero.io/backup-volumes-excludes: data
    image:
      repository: docker.io/filebrowser/filebrowser
      tag: v2.24.2@sha256:cad5de57ffb2d079598e8bc3fec51968920b79b3253e415a6d2f39c70d030bac
    env:
      TZ: "Europe/Paris"
      LOG_LEVEL: info
    controller:
      annotations:
        configmap.reloader.stakater.com/reload: filebrowser-settings
    configMaps:
      settings:
        enabled: true
        data:
          .filebrowser.json: |
            {
              "port": 80,
              "baseURL": "",
              "address": "",
              "log": "stdout",
              "database": "/config/database.db",
              "root": "/mnt/data",
              "branding.name": "Seedbox Cloud"
            }
    service:
      main:
        ports:
          http:
            port: 80
            protocol: TCP
    ingress:
      main:
        enabled: false
    persistence:
      settings:
        enabled: true
        type: configMap
        name: filebrowser-settings
        mountPath: /.filebrowser.json
        subPath: .filebrowser.json
        readOnly: true
      config:
        enabled: true
        existingClaim: "filebrowser-config"
        mountPath: /config
      data:
        enabled: true
        retain: true
        existingClaim: "all-data"
        mountPath: /mnt/data
