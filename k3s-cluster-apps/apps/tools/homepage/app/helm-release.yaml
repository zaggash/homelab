apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homepage
spec:
  interval: 15m
  chart:
    spec:
      chart: app-template
      version: "1.3.2"
      sourceRef:
        kind: HelmRepository
        name: bjw-s-charts
        namespace: flux-system
  maxHistory: 3
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    image:
      repository: ghcr.io/benphelps/homepage
      tag: v0.6.15@sha256:918646a24037f4c07fb6ec44df34e201ecc1e8f3c046340c877e4cbf5e463aab
    env:
      TZ: "Europe/Paris"
    serviceAccount:
      create: create
    controller:
      annotations:
        reloader.stakater.com/search: "true"
        configmap.reloader.stakater.com/reload: homepage-config
    service:
      main:
        ports:
          http:
            port: 3000
            protocol: TCP
    ingress:
      main:
        enabled: false

    configMaps:
      config:
        enabled: true
        data:
          settings.yaml: |
            ---
            title: Dashboard
            theme: dark
            color: neutral
            language: fr

          widgets.yaml: |
            ---
            - kubernetes:
                cluster:
                  show: false
                  cpu: false
                  memory: false
                  showLabel: false
                  label: "cluster"
                nodes:
                  show: true
                  cpu: true
                  memory: true
                  showLabel: true
            - search:
                provider: google
                target: _blank

          services.yaml: |
            ---

          bookmarks.yaml: |
            ---

          docker.yaml: |
            ---

          kubernetes.yaml: |
            ---
            mode: cluster

    persistence:
      config:
        enabled: true
        type: configMap
        name: homepage-config
        subPath:
          - path: settings.yaml
            mountPath: /app/config/settings.yaml
          - path: widgets.yaml
            mountPath: /app/config/widgets.yaml
          - path: services.yaml
            mountPath: /app/config/services.yaml
          - path: bookmarks.yaml
            mountPath: /app/config/bookmarks.yaml
          - path: docker.yaml
            mountPath: /app/config/docker.yaml
          - path: kubernetes.yaml
            mountPath: /app/config/kubernetes.yaml

