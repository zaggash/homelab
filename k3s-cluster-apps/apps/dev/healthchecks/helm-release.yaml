apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: healthchecks
spec:
  chart:
    spec:
      interval: 5m
      chart: app-template
      version: "1.2.1"
      sourceRef:
        kind: HelmRepository
        name: bjw-s-charts
        namespace: flux-system
  interval: 5m
  install:
    crds: Create
  maxHistory: 3
  upgrade:
    crds: CreateReplace
  values:
    image:
      repository: ghcr.io/linuxserver/healthchecks
      tag: 2.5.20230113@sha256:119cc23557c09ce5a8734131e9cc1400f7049e7678e67f8d39a54db847fcf36d
    dependsOn:
    - name: postgresql
      namespace: dev
    env:
      TZ: "Europe/Paris"
      DEBUG: "False"
      PROMETHEUS_ENABLED: "False"
      REGISTRATION_OPEN: "False"
      REGENERATE_SETTINGS: "True"
      SECRET_KEY: ${SECRET_HEALTHECKS_SECRET_KEY}
      SUPERUSER_EMAIL: ${SECRET_HEALTHCHECKS_SUPERUSER_EMAIL}
      SUPERUSER_PASSWORD: ${SECRET_HEALTHCHECKS_SUPERUSER_PASSWORD}
      DB: postgres
      DB_HOST: postgresql.dev.svc.cluster.local.
      DB_PORT: 5432
      DB_NAME: healthchecks
      DB_USER: healthchecks
      DB_PASSWORD: ${SECRET_HEALTHCHECKS_DB_PASSWORD}
      DISCORD_CLIENT_ID: "${SECRET_HEALTHCHECKS_DISCORD_CLIENT_ID}"
      DISCORD_CLIENT_SECRET: "${SECRET_HEALTHCHECKS_DISCORD_CLIENT_SECRET}"
      SITE_ROOT: "https://healthchecks.${SECRET_CLUSTER_DOMAIN}"
      SITE_NAME: "HealthBot"
      SITE_LOGO_URL: "https://raw.githubusercontent.com/gilbarbara/logos/master/logos/google-home.svg"
    service:
      main:
        ports:
          http:
            type: ClusterIP
            port: 8000
    ingress:
      main:
        enabled: false
    persistence:
      config:
        enabled: false
